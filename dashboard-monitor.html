<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Spring Boot Lightweight Monitor</title>
	<style>
		body {
			font-family: 'Segoe UI', Arial, sans-serif;
			margin: 0;
			padding: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			color: white;
		}
		.container {
			max-width: 1200px;
			margin: 0 auto;
		}
		h1 {
			text-align: center;
			margin-bottom: 30px;
			font-size: 2.5em;
			text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
		}
		.config {
			background: rgba(255,255,255,0.1);
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 20px;
			backdrop-filter: blur(10px);
		}
		.metrics-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}
		.metric-card {
			background: rgba(255,255,255,0.15);
			padding: 25px;
			border-radius: 15px;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255,255,255,0.2);
			transition: transform 0.3s ease;
		}
		.metric-card:hover {
			transform: translateY(-5px);
		}
		.metric-title {
			font-size: 1.2em;
			margin-bottom: 15px;
			color: #fff;
			border-bottom: 2px solid rgba(255,255,255,0.3);
			padding-bottom: 10px;
		}
		.metric-value {
			font-size: 2em;
			font-weight: bold;
			margin-bottom: 10px;
		}
		.metric-unit {
			font-size: 0.9em;
			opacity: 0.8;
		}
		.controls {
			text-align: center;
			margin-bottom: 20px;
		}
		button {
			background: rgba(255,255,255,0.2);
			color: white;
			border: none;
			padding: 12px 24px;
			border-radius: 25px;
			cursor: pointer;
			margin: 0 10px;
			font-size: 1em;
			transition: background 0.3s ease;
			border: 1px solid rgba(255,255,255,0.3);
		}
		button:hover {
			background: rgba(255,255,255,0.3);
		}
		button.active {
			background: rgba(255,255,255,0.4);
		}
		input {
			padding: 10px;
			border-radius: 5px;
			border: 1px solid rgba(255,255,255,0.3);
			background: rgba(255,255,255,0.1);
			color: white;
			margin: 0 10px;
		}
		input::placeholder {
			color: rgba(255,255,255,0.7);
		}
		.status {
			text-align: center;
			padding: 10px;
			margin-bottom: 20px;
			border-radius: 5px;
		}
		.status.success {
			background: rgba(76, 175, 80, 0.3);
		}
		.status.error {
			background: rgba(244, 67, 54, 0.3);
		}
		.progress-bar {
			width: 100%;
			height: 20px;
			background: rgba(255,255,255,0.2);
			border-radius: 10px;
			overflow: hidden;
			margin-top: 10px;
		}
		.progress-fill {
			height: 100%;
			background: linear-gradient(90deg, #4CAF50, #FFC107, #FF5722);
			transition: width 0.3s ease;
		}

		/* Tabs Styles */
		.tabs {
			display: flex;
			justify-content: center;
			margin-bottom: 30px;
			background: rgba(255,255,255,0.1);
			border-radius: 25px;
			padding: 5px;
			backdrop-filter: blur(10px);
		}

		.tab-button {
			background: transparent;
			color: white;
			border: none;
			padding: 15px 30px;
			border-radius: 20px;
			cursor: pointer;
			font-size: 1.1em;
			transition: all 0.3s ease;
			margin: 0 5px;
		}

		.tab-button:hover {
			background: rgba(255,255,255,0.2);
		}

		.tab-button.active {
			background: rgba(255,255,255,0.3);
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
		}

		.tab-content {
			display: none;
			animation: fadeIn 0.3s ease-in-out;
		}

		.tab-content.active {
			display: block;
		}

		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}

		/* Info Tab Styles */
		.info-sections {
			display: grid;
			gap: 30px;
		}

		.info-section {
			background: rgba(255,255,255,0.1);
			padding: 25px;
			border-radius: 15px;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255,255,255,0.2);
		}

		.info-section h2 {
			color: #fff;
			margin-bottom: 20px;
			font-size: 1.8em;
			text-align: center;
			border-bottom: 2px solid rgba(255,255,255,0.3);
			padding-bottom: 15px;
		}

		.info-card {
			background: rgba(255,255,255,0.1);
			margin-bottom: 20px;
			padding: 20px;
			border-radius: 10px;
			border-left: 4px solid #4CAF50;
		}

		.info-card h3 {
			color: #4CAF50;
			margin-bottom: 15px;
			font-size: 1.3em;
		}

		.info-card p {
			margin-bottom: 10px;
			line-height: 1.6;
		}

		.info-card ul {
			margin-left: 20px;
		}

		.info-card ul li {
			margin-bottom: 8px;
			line-height: 1.5;
		}

		.info-card code {
			background: rgba(0,0,0,0.3);
			padding: 2px 6px;
			border-radius: 3px;
			font-family: 'Courier New', monospace;
			color: #FFD700;
		}

		.footer {
			margin-top: 40px;
			padding: 30px 0 10px 0;
			background: rgba(0,0,0,0.15);
			border-radius: 15px;
			text-align: center;
			color: #fff;
			font-size: 1em;
			box-shadow: 0 2px 8px rgba(0,0,0,0.08);
		}
		.footer-section {
			margin-bottom: 18px;
		}
		.footer-section h3 {
			margin-bottom: 8px;
			font-size: 1.1em;
			color: #FFD700;
		}
		.footer a {
			color: #FFD700;
			text-decoration: underline;
		}
		.footer a:hover {
			color: #fff;
			text-decoration: none;
		}
	</style>
</head>
<body>
<div class="container">
	<h1>üöÄ Spring Boot Memory Monitor</h1>

	<!-- Configura√ß√£o -->
	<div class="config">
		<label>Actuator URL:</label>
		<input type="text" id="baseUrl" value="http://localhost:8080" placeholder="http://localhost:8080">
		<button onclick="updateBaseUrl()">Conectar</button>
	</div>

	<!-- Controles -->
	<div class="controls">
		<button id="refreshBtn" onclick="refreshMetrics()">üîÑ Refresh</button>
		<button id="autoRefreshBtn" onclick="toggleAutoRefresh()">‚è∞ Auto Refresh (OFF)</button>
		<span>Intervalo: </span>
		<input type="number" id="interval" value="5" min="1" max="60" style="width: 60px"> segundos
	</div>

	<!-- Status -->
	<div id="status" class="status"></div>

	<!-- Abas -->
	<div class="tabs">
		<button class="tab-button active" onclick="switchTab('metrics')">üìä M√©tricas</button>
		<button class="tab-button" onclick="switchTab('info')">‚ÑπÔ∏è Informa√ß√µes</button>
	</div>

	<!-- Conte√∫do das Abas -->
	<div id="metricsTab" class="tab-content active">
		<div class="metrics-grid" id="metricsGrid">
			<!-- Metrics will be populated here -->
		</div>
	</div>

	<div id="infoTab" class="tab-content">
		<div class="info-sections">
			<div class="info-section">
				<h2>üß† Memory Metrics</h2>
				<div class="info-card">
					<h3>Heap Memory Used</h3>
					<p><strong>What it is:</strong> Amount of heap memory currently in use by the JVM.</p>
					<p><strong>Why it matters:</strong> Indicates how much of the available memory is consumed by application objects.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> If constantly > 80% of max, may indicate memory leak or need for more memory.</p>
					<p><strong>‚úÖ Ideal:</strong> Between 40-70% of heap max during normal operation.</p>
				</div>
				<div class="info-card">
					<h3>Heap Memory Max</h3>
					<p><strong>What it is:</strong> Maximum amount of heap memory the JVM can use (defined by -Xmx).</p>
					<p><strong>Why it matters:</strong> Defines the upper limit for object allocation.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> If too low, may cause OutOfMemoryError. If too high, may impact GC.</p>
					<p><strong>‚úÖ Ideal:</strong> Configure based on application profile and available resources.</p>
				</div>
				<div class="info-card">
					<h3>Non-Heap Memory Used</h3>
					<p><strong>What it is:</strong> Memory used outside the heap (Metaspace, Code Cache, etc.).</p>
					<p><strong>Why it matters:</strong> Includes compiled bytecode, class metadata, etc.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> Constant growth may indicate excessive class loading.</p>
					<p><strong>‚úÖ Ideal:</strong> Stable after application warmup.</p>
				</div>
			</div>
			<div class="info-section">
				<h2>‚ö° Performance Metrics</h2>
				<div class="info-card">
					<h3>CPU Usage</h3>
					<p><strong>What it is:</strong> System CPU usage percentage.</p>
					<p><strong>Why it matters:</strong> Indicates overall computational load of the system.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> Constantly > 80% may indicate CPU bottleneck.</p>
					<p><strong>‚úÖ Ideal:</strong> < 70% in normal operation, allowing occasional spikes.</p>
				</div>
				<div class="info-card">
					<h3>Live Threads</h3>
					<p><strong>What it is:</strong> Number of active threads in the JVM.</p>
					<p><strong>Why it matters:</strong> Too many threads can impact performance and consume memory.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> Uncontrolled growth may indicate thread leaks.</p>
					<p><strong>‚úÖ Ideal:</strong> Stable number, proportional to workload.</p>
				</div>
			</div>
			<div class="info-section">
				<h2>üóëÔ∏è Garbage Collection</h2>
				<div class="info-card">
					<h3>GC Memory Allocated</h3>
					<p><strong>What it is:</strong> Total memory allocated and subsequently collected by GC.</p>
					<p><strong>Why it matters:</strong> Indicates allocation activity and GC pressure.</p>
					<p><strong>‚ö†Ô∏è Alert:</strong> Rapid growth may indicate high allocation rate.</p>
					<p><strong>‚úÖ Ideal:</strong> Linear and predictable growth.</p>
				</div>
			</div>
			<div class="info-section">
				<h2>üéØ Optimization Tips</h2>
				<div class="info-card">
					<h3>Memory Management</h3>
					<ul>
						<li><strong>String Pooling:</strong> Use <code>StringBuilder</code> for concatenation in loops</li>
						<li><strong>Object Reuse:</strong> Implement object pooling for expensive objects</li>
						<li><strong>Lazy Loading:</strong> Load resources only when needed</li>
						<li><strong>Weak References:</strong> Use for caches that can be freed by GC</li>
					</ul>
				</div>
				<div class="info-card">
					<h3>JVM Tuning</h3>
					<ul>
						<li><strong>-Xmx:</strong> Set heap max based on application profile</li>
						<li><strong>-XX:+UseG1GC:</strong> G1GC for applications with heap > 4GB</li>
						<li><strong>-XX:MaxGCPauseMillis:</strong> Configure GC pause target</li>
						<li><strong>-XX:+HeapDumpOnOutOfMemoryError:</strong> For memory leak debugging</li>
					</ul>
				</div>

				<div class="info-card">
					<h3>Monitoring Best Practices</h3>
					<ul>
						<li>üìä <strong>Alerts:</strong> Set alerts for CPU > 80%, Memory > 85%</li>
						<li>üìà <strong>Trending:</strong> Use Prometheus + Grafana for historical analysis</li>
						<li>üîç <strong>Profiling:</strong> Use JProfiler/VisualVM for detailed analysis</li>
						<li>üìù <strong>Logs:</strong> Monitor GC logs for anomalous patterns</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<footer class="footer">
	<div class="footer-section">
		<h3>About the Author</h3>
		<p>
			Developed by <a href="https://github.com/fhgomes/fhgomes" target="_blank" rel="noopener">fhgomes</a>
		</p>
	</div>
	<div class="footer-section">
		<h3>License</h3>
		<p>
			This project is licensed under the <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener">MIT License</a>.
		</p>
	</div>
	<div class="footer-section">
		<h3>Contributing</h3>
		<p>
			Contributions are welcome! See the <a href="https://github.com/fhgomes/lightweight-spring-actuator-observer#contributing" target="_blank" rel="noopener">project page</a> for details.
		</p>
	</div>
	<div class="footer-section">
		<h3>Source Code</h3>
		<p>
			View on <a href="https://github.com/fhgomes/lightweight-spring-actuator-observer" target="_blank" rel="noopener">GitHub</a>
		</p>
	</div>
</footer>
<style>
	.footer {
		margin-top: 40px;
		padding: 30px 0 10px 0;
		background: rgba(0,0,0,0.15);
		border-radius: 15px;
		text-align: center;
		color: #fff;
		font-size: 1em;
		box-shadow: 0 2px 8px rgba(0,0,0,0.08);
	}
	.footer-section {
		margin-bottom: 18px;
	}
	.footer-section h3 {
		margin-bottom: 8px;
		font-size: 1.1em;
		color: #FFD700;
	}
	.footer a {
		color: #FFD700;
		text-decoration: underline;
	}
	.footer a:hover {
		color: #fff;
		text-decoration: none;
	}
</style>

<script>
	let baseUrl = 'http://localhost:8080';
	let autoRefreshInterval = null;
	let isAutoRefreshOn = false;

	const metrics = [
		{
			id: 'heap-used',
			endpoint: '/actuator/metrics/jvm.memory.used?tag=area:heap',
			title: 'Heap Memory Used',
			unit: 'MB',
			format: value => (value / 1024 / 1024).toFixed(2)
		},
		{
			id: 'heap-max',
			endpoint: '/actuator/metrics/jvm.memory.max?tag=area:heap',
			title: 'Heap Memory Max',
			unit: 'MB',
			format: value => (value / 1024 / 1024).toFixed(2)
		},
		{
			id: 'nonheap-used',
			endpoint: '/actuator/metrics/jvm.memory.used?tag=area:nonheap',
			title: 'Non-Heap Memory Used',
			unit: 'MB',
			format: value => (value / 1024 / 1024).toFixed(2)
		},
		{
			id: 'cpu-usage',
			endpoint: '/actuator/metrics/system.cpu.usage',
			title: 'CPU Usage',
			unit: '%',
			format: value => (value * 100).toFixed(2)
		},
		{
			id: 'gc-allocated',
			endpoint: '/actuator/metrics/jvm.gc.memory.allocated',
			title: 'GC Memory Allocated',
			unit: 'MB',
			format: value => (value / 1024 / 1024).toFixed(2)
		},
		{
			id: 'threads',
			endpoint: '/actuator/metrics/jvm.threads.live',
			title: 'Live Threads',
			unit: 'threads',
			format: value => Math.round(value)
		}
	];

	function updateBaseUrl() {
		baseUrl = document.getElementById('baseUrl').value.replace(/\/$/, '');
		refreshMetrics();
	}

	function createMetricCard(metric) {
		return `
                <div class="metric-card" id="card-${metric.id}">
                    <div class="metric-title">${metric.title}</div>
                    <div class="metric-value" id="value-${metric.id}">--</div>
                    <div class="metric-unit">${metric.unit}</div>
                    <div class="progress-bar" id="progress-${metric.id}" style="display: none;">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            `;
	}

	function initializeGrid() {
		const grid = document.getElementById('metricsGrid');
		grid.innerHTML = metrics.map(createMetricCard).join('');
	}

	async function fetchMetric(metric) {
		try {
			const response = await fetch(baseUrl + metric.endpoint);
			if (!response.ok) throw new Error(`HTTP ${response.status}`);

			const data = await response.json();
			const value = data.measurements?.[0]?.value;

			if (value !== undefined) {
				const formattedValue = metric.format(value);
				document.getElementById(`value-${metric.id}`).textContent = formattedValue;

				// Show progress bar for memory metrics
				if (metric.id.includes('heap') && metric.id === 'heap-used') {
					const maxMetric = metrics.find(m => m.id === 'heap-max');
					const maxResponse = await fetch(baseUrl + maxMetric.endpoint);
					if (maxResponse.ok) {
						const maxData = await maxResponse.json();
						const maxValue = maxData.measurements?.[0]?.value;
						if (maxValue) {
							const percentage = (value / maxValue) * 100;
							const progressBar = document.getElementById(`progress-${metric.id}`);
							progressBar.style.display = 'block';
							progressBar.querySelector('.progress-fill').style.width = percentage + '%';
						}
					}
				}

				return true;
			}
		} catch (error) {
			document.getElementById(`value-${metric.id}`).textContent = 'Error';
			console.error(`Error fetching ${metric.title}:`, error);
			return false;
		}
		return false;
	}

	async function refreshMetrics() {
		const status = document.getElementById('status');
		status.textContent = 'üîÑ Carregando m√©tricas...';
		status.className = 'status';

		let successCount = 0;
		const promises = metrics.map(async (metric) => {
			const success = await fetchMetric(metric);
			if (success) successCount++;
		});

		await Promise.all(promises);

		if (successCount > 0) {
			status.textContent = `‚úÖ ${successCount}/${metrics.length} m√©tricas carregadas - ${new Date().toLocaleTimeString()}`;
			status.className = 'status success';
		} else {
			status.textContent = '‚ùå Erro ao carregar m√©tricas. Verifique se o Actuator est√° habilitado e acess√≠vel.';
			status.className = 'status error';
		}
	}

	function toggleAutoRefresh() {
		const btn = document.getElementById('autoRefreshBtn');
		const intervalInput = document.getElementById('interval');

		if (isAutoRefreshOn) {
			clearInterval(autoRefreshInterval);
			btn.textContent = '‚è∞ Auto Refresh (OFF)';
			btn.classList.remove('active');
			isAutoRefreshOn = false;
		} else {
			const interval = parseInt(intervalInput.value) * 1000;
			autoRefreshInterval = setInterval(refreshMetrics, interval);
			btn.textContent = '‚è∞ Auto Refresh (ON)';
			btn.classList.add('active');
			isAutoRefreshOn = true;
			refreshMetrics(); // First refresh
		}
	}

	// Initialize
	document.addEventListener('DOMContentLoaded', function() {
		initializeGrid();
		refreshMetrics();
	});

	// Handle Enter key in URL input
	document.getElementById('baseUrl').addEventListener('keypress', function(e) {
		if (e.key === 'Enter') {
			updateBaseUrl();
		}
	});

	// Tab functionality
	function switchTab(tabName) {
		// Remove active class from all tabs
		document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
		document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

		// Add active class to selected tab
		event.target.classList.add('active');
		document.getElementById(tabName + 'Tab').classList.add('active');
	}
</script>
</body>
</html>